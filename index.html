<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í•˜ë…¸ì´ì˜ íƒ‘</title>
<style>
  :root{
    --fg:#e5e7eb; --muted:#94a3b8; --bg: radial-gradient(1200px 800px at 20% -10%, #1f2937, #0b0c10);
    --card:#0b1220; --card-br:#1f2a44; --accent:#60a5fa; --accent2:#10b981;
    --pole:#1f2937; --base:#0f172a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", Segoe UI, Roboto, Helvetica, Arial; color:var(--fg); background:var(--bg); display:flex; align-items:center; justify-content:center; padding:20px}
  .app{width:min(1100px,100%)}
  .topbar{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:14px}
  .title{font-weight:900; letter-spacing:.2px; font-size:clamp(18px,3vw,28px)}
  .controls{display:flex; gap:8px; flex-wrap:wrap}
  button{background:#111827; border:1px solid #262b36; color:var(--fg); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700; transition:.15s transform,.15s opacity}
  button:hover{transform:translateY(-1px)}
  button[disabled]{opacity:.5; cursor:not-allowed}

  .board{position:relative; background:var(--card); border:1px solid var(--card-br); border-radius:18px; padding:18px; box-shadow:0 10px 40px #0006}
  .stage{display:grid; grid-template-columns:repeat(3,1fr); gap:16px; align-items:end; min-height:360px}
  .peg{position:relative; height:360px; background:linear-gradient(#0b1220,#0b1220) padding-box, conic-gradient(from 0deg, #1f2a44, #0e1726) border-box; border:1px solid #1f2a44; border-radius:14px; padding:16px}
  .pole{position:absolute; left:50%; transform:translateX(-50%); bottom:70px; width:12px; height:250px; background:var(--pole); border-radius:999px}
  .base{position:absolute; left:10%; right:10%; bottom:40px; height:18px; background:var(--base); border-radius:12px}
  .slot{position:absolute; left:10%; right:10%; bottom:58px; height:0}

  .disk{position:absolute; height:28px; left:50%; transform:translateX(-50%); border-radius:10px; display:grid; place-items:center; color:#0b1220; font-weight:900; letter-spacing:.2px; text-shadow:none; border:1px solid #0f172a}
  .disk[data-sel="1"]{outline:3px solid var(--accent2)}

  .legend{margin-top:10px; color:var(--muted); font-size:14px}
  .pill{padding:6px 10px; border-radius:999px; background:#0b1220; border:1px solid #233047}

  .toast{position:fixed; right:16px; bottom:16px; background:#0b1220; border:1px solid #1f2a44; padding:10px 12px; border-radius:10px; font-size:14px; opacity:0; transform:translateY(8px); transition:.2s}
  .toast.show{opacity:1; transform:translateY(0)}

  .overlay{position:fixed; inset:0; background: radial-gradient(1000px 700px at 30% -10%, #18212f, #090b0f); display:none; align-items:center; justify-content:center; z-index:10000; pointer-events:auto}
  .overlay.show{display:flex}
  .card{background:var(--card); border:1px solid var(--card-br); border-radius:16px; padding:22px; width:min(92vw,560px); text-align:center}
  .card h1{margin:0 0 10px}
</style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="title">ğŸ—¼ í•˜ë…¸ì´ì˜ íƒ‘ <span class="pill" id="stageLabel">Stage 1 Â· 3ê°œ</span></div>
      <div class="controls">
        <button id="btnStartScreen">ì´ˆê¸° í™”ë©´</button>
        <button id="btnReset">ë¦¬ì…‹</button>
        <button id="btnUndo" disabled>ë˜ëŒë¦¬ê¸°</button>
        <button id="btnSolve" style="display:none">ìë™í•´ê²°</button>
        <button id="btnNext" disabled>ë‹¤ìŒ ìŠ¤í…Œì´ì§€ â–¶</button>
      </div>
    </div>

    <div class="board">
      <div class="stage" id="stage">
        <div class="peg" data-i="0" role="button" aria-label="ê¸°ë‘¥ A"></div>
        <div class="peg" data-i="1" role="button" aria-label="ê¸°ë‘¥ B"></div>
        <div class="peg" data-i="2" role="button" aria-label="ê¸°ë‘¥ C"></div>
      </div>
      <div class="legend">ê¸°ë‘¥ì„ í´ë¦­í•˜ì—¬ ì›ë°˜ì„ ì˜®ê¸°ì„¸ìš”. (ì‘ì€ ì›ë°˜ì´ í° ì›ë°˜ ìœ„ë¡œë§Œ ê°€ëŠ¥)</div>
    </div>
  </div>

  <div class="toast" id="toast">ì•ˆë‚´</div>

  <!-- ì‹œì‘ ì˜¤ë²„ë ˆì´ (ìŠ¤í…Œì´ì§€ ì„ íƒ ì œê±°, ìˆœì°¨ ì§„í–‰) -->
  <div class="overlay show" id="overlayStart">
    <div class="card">
      <h1>í•˜ë…¸ì´ì˜ íƒ‘</h1>
      <p>ì™¼ìª½ ê¸°ë‘¥(A)ì—ì„œ <b>ë‹¤ë¥¸ ì–´ëŠ í•œ ê¸°ë‘¥(B ë˜ëŠ” C)</b>ìœ¼ë¡œ ëª¨ë“  ì›ë°˜ì„ ì˜®ê¸°ë©´ í´ë¦¬ì–´ì…ë‹ˆë‹¤. (3ê°œ â†’ 7ê°œ ìˆœì„œ ì§„í–‰)</p>
      <button id="btnStart" type="button">ê²Œì„ ì‹œì‘</button>
    </div>
  </div>

  <!-- ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì˜¤ë²„ë ˆì´ -->
  <div class="overlay" id="overlayStageClear">
    <div class="card">
      <h1 id="stageClearTitle">ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´!</h1>
      <p id="stageClearDesc">ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì§„í–‰í•  ìˆ˜ ìˆì–´ìš”.</p>
      <button id="btnProceed" type="button">ë‹¤ìŒ ìŠ¤í…Œì´ì§€ â–¶</button>
    </div>
  </div>

  <!-- ëª¨ë“  ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì˜¤ë²„ë ˆì´ -->
  <div class="overlay" id="overlayFinal">
    <div class="card">
      <h1>ëª¨ë“  ìŠ¤í…Œì´ì§€ ì™„ë£Œ ğŸ‰</h1>
      <p>ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ ë‹¤ì‹œ í”Œë ˆì´í•  ìˆ˜ ìˆì–´ìš”.</p>
      <button id="btnFinalToStart" type="button">ì´ˆê¸° í™”ë©´ìœ¼ë¡œ</button>
    </div>
  </div>

<script>
(function(){
  const stages=[3,4,5,6,7];
  let stageIndex=0; let N=stages[stageIndex];

  const stageEl = document.getElementById('stage');
  const pegs = [...stageEl.querySelectorAll('.peg')];
  const btnStart = document.getElementById('btnStart');
  const btnReset = document.getElementById('btnReset');
  const btnUndo = document.getElementById('btnUndo');
  const btnSolve = document.getElementById('btnSolve'); // hidden (keyboard cheat only)
  const btnStartScreen = document.getElementById('btnStartScreen');
  const btnNext = document.getElementById('btnNext');
  const overlayStart = document.getElementById('overlayStart');
  const overlayStageClear = document.getElementById('overlayStageClear');
  const overlayFinal = document.getElementById('overlayFinal');
  const btnProceed = document.getElementById('btnProceed');
  const btnFinalToStart = document.getElementById('btnFinalToStart');
  const stageLabel = document.getElementById('stageLabel');
  const toast = document.getElementById('toast');

  let stacks=[[],[],[]];
  let history=[];
  let selectedPeg=null;
  let solving=false;

  const diskColors = ['#93c5fd','#60a5fa','#3b82f6','#2563eb','#1d4ed8','#10b981','#14b8a6'];

  const showToast=(m)=>{ toast.textContent=m; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1100); };
  const canMove=(from,to)=>{ if(from===to) return false; if(stacks[from].length===0) return false; const disk=stacks[from][stacks[from].length-1]; const top=stacks[to][stacks[to].length-1]; return top===undefined || disk<top; };

  function updateStageLabel(){ stageLabel.textContent=`Stage ${stageIndex+1} Â· ${N}ê°œ`; }

  function layout(){
    pegs.forEach(peg=>{ peg.innerHTML = '<div class="pole"></div><div class="base"></div><div class="slot"></div>'; });
    const maxWidth=260, minWidth=70, h=28;
    for(let i=0;i<3;i++){
      const slot=pegs[i].querySelector('.slot');
      const arr=stacks[i];
      arr.forEach((size, idxOnPeg)=>{
        const d=document.createElement('div'); d.className='disk';
        const frac=size/N; const w=Math.round(minWidth+(maxWidth-minWidth)*frac);
        d.style.width=w+'px'; d.style.bottom = (idxOnPeg*h)+'px';
        d.style.background=diskColors[(size-1)%diskColors.length];
        d.textContent=size; d.dataset.size=size; slot.appendChild(d);
      });
    }
    // selection outline
    pegs.forEach((peg,i)=>{
      const slot=peg.querySelector('.slot');
      const topDisk=slot.querySelector('.disk:last-child');
      slot.querySelectorAll('.disk').forEach(el=>el.dataset.sel='0');
      if(selectedPeg===i && topDisk){ topDisk.dataset.sel='1'; }
    });
    btnUndo.disabled = history.length===0;
    btnNext.disabled = true; // ìˆ˜ë™ nextëŠ” í´ë¦¬ì–´ í›„ë§Œ
  }

  function init(){
    N=stages[stageIndex];
    updateStageLabel();
    stacks=[[],[],[]]; history=[]; selectedPeg=null; solving=false;
    for(let s=N; s>=1; s--) stacks[0].push(s);
    layout();
  }

  function move(from,to){
    if(!canMove(from,to)) { showToast('ê·¸ ì´ë™ì€ ë¶ˆê°€í•´ìš”'); return false; }
    const disk=stacks[from].pop(); stacks[to].push(disk); history.push([from,to]); selectedPeg=null; layout();
    checkWin(); return true;
  }

  function checkWin(){
    // ì„±ê³µ ì¡°ê±´: ì‹œì‘ ê¸°ë‘¥(0)ì´ ì•„ë‹Œ ì–´ëŠ í•œ ê¸°ë‘¥(1 ë˜ëŠ” 2)ì— ëª¨ë“  ì›ë°˜ì´ ëª¨ì´ë©´ í´ë¦¬ì–´
    if(stacks[1].length===N || stacks[2].length===N){
      document.getElementById('stageClearTitle').textContent=`Stage ${stageIndex+1} í´ë¦¬ì–´!`;
      document.getElementById('stageClearDesc').textContent=(stageIndex<stages.length-1)?`ë‹¤ìŒì€ ${stages[stageIndex+1]}ê°œ ìŠ¤í…Œì´ì§€ì…ë‹ˆë‹¤.`:'ëª¨ë“  ìŠ¤í…Œì´ì§€ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!';
      overlayStageClear.classList.add('show');
      btnNext.disabled=false; // ìƒë‹¨ ë²„íŠ¼ë„ í™œì„±í™”
    }
  } í´ë¦¬ì–´!`;
      document.getElementById('stageClearDesc').textContent=(stageIndex<stages.length-1)?`ë‹¤ìŒì€ ${stages[stageIndex+1]}ê°œ ìŠ¤í…Œì´ì§€ì…ë‹ˆë‹¤.`:'ëª¨ë“  ìŠ¤í…Œì´ì§€ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!';
      overlayStageClear.classList.add('show');
      btnNext.disabled=false; // ìƒë‹¨ ë²„íŠ¼ë„ í™œì„±í™”
    } }

  // ìë™í•´ê²°
  async function autoSolve(){ if(solving) return; solving=true; btnSolve.disabled=true; const moves=[]; const solve=(n,from,aux,to)=>{ if(n===0) return; solve(n-1,from,to,aux); moves.push([from,to]); solve(n-1,aux,from,to); }; solve(N,0,1,2); for(const [a,b] of moves){ if(!solving) break; move(a,b); await new Promise(r=>setTimeout(r,120)); } solving=false; btnSolve.disabled=false; }

  // ì´ë²¤íŠ¸
  pegs.forEach(peg=>{
    peg.addEventListener('click', ()=>{
      if(solving) return; const i=+peg.dataset.i;
      if(selectedPeg===null){ if(stacks[i].length===0){ showToast('ì´ë™í•  ì›ë°˜ì´ ì—†ì–´ìš”'); return; } selectedPeg=i; layout(); }
      else{ if(i===selectedPeg){ selectedPeg=null; layout(); return; } move(selectedPeg,i); }
    }, {passive:true});
  });

  btnUndo.addEventListener('click', ()=>{ if(history.length===0) return; const [from,to]=history.pop(); const disk=stacks[to].pop(); stacks[from].push(disk); selectedPeg=null; layout(); });
  btnReset.addEventListener('click', ()=>{ init(); });
  btnSolve.addEventListener('click', ()=>{ autoSolve(); });

  // ì˜¤ë²„ë ˆì´ ë™ì‘
  btnStart.addEventListener('pointerdown', (ev)=>{ ev.preventDefault(); ev.stopPropagation(); });
  btnStart.addEventListener('click', (ev)=>{ ev.preventDefault(); ev.stopPropagation(); overlayStart.classList.remove('show'); init(); });
  btnStartScreen.addEventListener('click', ()=>{ overlayFinal.classList.remove('show'); overlayStageClear.classList.remove('show'); overlayStart.classList.add('show'); });

  function goNextStage(){ if(stageIndex<stages.length-1){ stageIndex++; init(); overlayStageClear.classList.remove('show'); } else { overlayStageClear.classList.remove('show'); overlayFinal.classList.add('show'); } }
  btnProceed.addEventListener('click', goNextStage);
  btnNext.addEventListener('click', ()=>{ if(!btnNext.disabled) goNextStage(); });
  btnFinalToStart.addEventListener('click', ()=>{ overlayFinal.classList.remove('show'); overlayStart.classList.add('show'); stageIndex=0; init(); });

  // í‚¤ë³´ë“œ ì¹˜íŠ¸: ` (Backquote)ë¡œ ì•”í˜¸í™”, Enter=ìë™í•´ê²°, â†/â†’=ìŠ¤í…Œì´ì§€ ì´ë™
  let cheatArmed=false; let cheatTimer=null;
  function armCheat(){ cheatArmed=true; clearTimeout(cheatTimer); cheatTimer=setTimeout(()=>cheatArmed=false,1500); }
  function prevStage(){ if(stageIndex>0){ stageIndex--; overlayStageClear.classList.remove('show'); overlayFinal.classList.remove('show'); init(); } }
  function nextStage(){ if(stageIndex<stages.length-1){ stageIndex++; overlayStageClear.classList.remove('show'); init(); } else { overlayFinal.classList.add('show'); } }
  window.addEventListener('keydown', (e)=>{
    if(e.code==='Backquote'){ armCheat(); }
    else if(e.key==='Enter' && cheatArmed){ cheatArmed=false; clearTimeout(cheatTimer); autoSolve(); }
    else if(e.key==='ArrowLeft' && cheatArmed){ cheatArmed=false; clearTimeout(cheatTimer); prevStage(); }
    else if(e.key==='ArrowRight' && cheatArmed){ cheatArmed=false; clearTimeout(cheatTimer); nextStage(); }
  }, {passive:true});

  // ì´ˆê¸°: ì‹œì‘ ì˜¤ë²„ë ˆì´ í‘œì‹œ
  overlayStart.classList.add('show');
})();
</script>
</body>
</html>
