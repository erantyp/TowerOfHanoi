<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>하노이의 탑</title>
<style>
  :root{
    --fg:#e5e7eb; --muted:#94a3b8; --bg: radial-gradient(1200px 800px at 20% -10%, #1f2937, #0b0c10);
    --card:#0b1220; --card-br:#1f2a44; --accent:#60a5fa; --accent2:#10b981;
    --pole:#1f2937; --base:#0f172a; --disk:#60a5fa; --bad:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", Segoe UI, Roboto, Helvetica, Arial; color:var(--fg); background:var(--bg); display:flex; align-items:center; justify-content:center; padding:20px}
  .app{width:min(1100px,100%)}
  .topbar{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:14px}
  .title{font-weight:900; letter-spacing:.2px; font-size:clamp(18px,3vw,28px)}
  .controls{display:flex; gap:8px; flex-wrap:wrap}
  button{background:#111827; border:1px solid #262b36; color:var(--fg); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700; transition:.15s transform,.15s opacity}
  button:hover{transform:translateY(-1px)}
  button[disabled]{opacity:.5; cursor:not-allowed}
  select,input{background:#0b1220; color:var(--fg); border:1px solid #1f2a44; border-radius:8px; padding:6px 10px}

  .board{position:relative; background:var(--card); border:1px solid var(--card-br); border-radius:18px; padding:18px; box-shadow:0 10px 40px #0006}
  .stage{display:grid; grid-template-columns:repeat(3,1fr); gap:16px; align-items:end; min-height:360px}
  .peg{position:relative; height:360px; background:linear-gradient(#0b1220,#0b1220) padding-box, conic-gradient(from 0deg, #1f2a44, #0e1726) border-box; border:1px solid #1f2a44; border-radius:14px; padding:16px}
  .pole{position:absolute; left:50%; transform:translateX(-50%); bottom:70px; width:12px; height:250px; background:var(--pole); border-radius:999px}
  .base{position:absolute; left:10%; right:10%; bottom:40px; height:18px; background:var(--base); border-radius:12px}
  .slot{position:absolute; left:10%; right:10%; bottom:60px; height:0}

  .disk{position:absolute; height:28px; left:50%; transform:translateX(-50%); border-radius:10px; display:grid; place-items:center; color:#0b1220; font-weight:900; letter-spacing:.2px; text-shadow:none; border:1px solid #0f172a}
  .disk[data-sel="1"]{outline:3px solid var(--accent2)}

  .legend{margin-top:10px; color:var(--muted); font-size:14px}
  .toast{position:fixed; right:16px; bottom:16px; background:#0b1220; border:1px solid #1f2a44; padding:10px 12px; border-radius:10px; font-size:14px; opacity:0; transform:translateY(8px); transition:.2s}
  .toast.show{opacity:1; transform:translateY(0)}

  .overlay{position:fixed; inset:0; background: radial-gradient(1000px 700px at 30% -10%, #18212f, #090b0f); display:flex; align-items:center; justify-content:center; z-index:10000; pointer-events:auto}
  .overlay[hidden]{display:none}
  .card{background:var(--card); border:1px solid var(--card-br); border-radius:16px; padding:22px; width:min(92vw,560px); text-align:center}
  .card h1{margin:0 0 10px}
</style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="title">🗼 하노이의 탑</div>
      <div class="controls">
        <label>원반
          <select id="selN">
            <option>3</option>
            <option selected>4</option>
            <option>5</option>
            <option>6</option>
            <option>7</option>
          </select>
        </label>
        <button id="btnStartScreen">초기 화면</button>
        <button id="btnReset">리셋</button>
        <button id="btnUndo" disabled>되돌리기</button>
        <button id="btnSolve">자동해결</button>
      </div>
    </div>

    <div class="board">
      <div class="stage" id="stage">
        <div class="peg" data-i="0" role="button" aria-label="기둥 A"></div>
        <div class="peg" data-i="1" role="button" aria-label="기둥 B"></div>
        <div class="peg" data-i="2" role="button" aria-label="기둥 C"></div>
      </div>
      <div class="legend">기둥을 클릭하여 원반을 옮기세요. (작은 원반이 큰 원반 위로만 가능)</div>
    </div>
  </div>

  <div class="toast" id="toast">안내</div>

  <!-- 시작 오버레이: 클릭 관통 방지 + 최상단 보장 -->
  <div class="overlay" id="overlayStart">
    <div class="card">
      <h1>하노이의 탑</h1>
      <p>규칙: 한 번에 하나의 원반만 이동, 더 작은 원반만 더 큰 원반 위에 올릴 수 있습니다.</p>
      <button id="btnStart" type="button">게임 시작</button>
    </div>
  </div>

<script>
(function(){
  const selN = document.getElementById('selN');
  const stageEl = document.getElementById('stage');
  const pegs = [...stageEl.querySelectorAll('.peg')];
  const btnStart = document.getElementById('btnStart');
  const btnReset = document.getElementById('btnReset');
  const btnUndo = document.getElementById('btnUndo');
  const btnSolve = document.getElementById('btnSolve');
  const btnStartScreen = document.getElementById('btnStartScreen');
  const overlayStart = document.getElementById('overlayStart');
  const toast = document.getElementById('toast');

  let N = +selN.value;
  let stacks = [[],[],[]]; // 0=left,1=mid,2=right (bottom -> top)
  let history = []; // for undo
  let selectedPeg = null; // source index
  let solving = false;

  const diskColors = ['#93c5fd','#60a5fa','#3b82f6','#2563eb','#1d4ed8','#10b981','#14b8a6'];

  // --- Utils ---
  const showToast=(m)=>{ toast.textContent=m; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1100); };
  const idx=(i)=>Math.max(0,Math.min(2,i|0));
  const canMove=(from,to)=>{
    if(from===to) return false;
    if(stacks[from].length===0) return false;
    const disk = stacks[from][stacks[from].length-1];
    const top = stacks[to][stacks[to].length-1];
    return top===undefined || disk<top;
  };

  function layout(){
    // clear
    pegs.forEach(peg=>{
      peg.innerHTML = '<div class="pole"></div><div class="base"></div><div class="slot"></div>';
    });
    // render disks
    const maxWidth = 260; // px
    const minWidth = 70;  // px
    for(let i=0;i<3;i++){
      const slot = pegs[i].querySelector('.slot');
      const arr = stacks[i];
      const h = 28; // disk height
      arr.forEach((size, idxOnPeg)=>{
        const d = document.createElement('div');
        d.className='disk';
        const frac = (size)/(N);
        const w = Math.round(minWidth + (maxWidth-minWidth)*frac);
        d.style.width = w+'px';
        d.style.bottom = (60 + idxOnPeg*h)+'px';
        d.style.background = diskColors[(size-1)%diskColors.length];
        d.textContent = size;
        d.dataset.size = size;
        slot.appendChild(d);
      });
    }
    // selection outline
    pegs.forEach((peg,i)=>{
      const slot=peg.querySelector('.slot');
      const topDisk = slot.querySelector('.disk:last-child');
      slot.querySelectorAll('.disk').forEach(el=>el.dataset.sel='0');
      if(selectedPeg===i && topDisk){ topDisk.dataset.sel='1'; }
    });
    btnUndo.disabled = history.length===0;
  }

  function init(){
    N = +selN.value;
    stacks=[[],[],[]];
    for(let s=N; s>=1; s--) stacks[0].push(s);
    history=[]; selectedPeg=null; solving=false;
    layout();
  }

  function move(from,to){
    if(!canMove(from,to)) { showToast('그 이동은 불가해요'); return false; }
    const disk = stacks[from].pop();
    stacks[to].push(disk);
    history.push([from,to]);
    selectedPeg=null;
    layout();
    checkWin();
    return true;
  }

  function checkWin(){
    if(stacks[2].length===N){
      showToast('클리어! 🎉');
    }
  }

  // Auto-solve using recursion (iterative stack) to avoid blocking UI
  async function autoSolve(){
    if(solving) return; solving=true; btnSolve.disabled=true;
    const moves=[];
    const solve=(n,from,aux,to)=>{
      if(n===0) return;
      solve(n-1,from,to,aux);
      moves.push([from,to]);
      solve(n-1,aux,from,to);
    };
    solve(N,0,1,2);
    for(const [a,b] of moves){
      if(!solving) break;
      move(a,b);
      await new Promise(r=>setTimeout(r, 150));
    }
    solving=false; btnSolve.disabled=false;
  }

  // --- Events ---
  pegs.forEach(peg=>{
    peg.addEventListener('click', (e)=>{
      if(solving) return;
      const i = +peg.dataset.i;
      if(selectedPeg===null){
        if(stacks[i].length===0){ showToast('이동할 원반이 없어요'); return; }
        selectedPeg=i; layout();
      }else{
        if(i===selectedPeg){ selectedPeg=null; layout(); return; }
        move(selectedPeg,i);
      }
    }, {passive:true});
  });

  btnUndo.addEventListener('click', ()=>{
    if(history.length===0) return;
    const [from,to] = history.pop();
    const disk = stacks[to].pop();
    stacks[from].push(disk);
    selectedPeg=null; layout();
  });

  btnReset.addEventListener('click', ()=>{ init(); });
  btnSolve.addEventListener('click', ()=>{ autoSolve(); });

  // 시작 오버레이: pointerdown + click 모두 전파 차단으로 클릭 관통 방지
  btnStart.addEventListener('pointerdown', (ev)=>{ ev.preventDefault(); ev.stopPropagation(); });
  btnStart.addEventListener('click', (ev)=>{
    ev.preventDefault(); ev.stopPropagation();
    overlayStart.setAttribute('hidden','');
    init();
  });

  btnStartScreen.addEventListener('click', ()=>{
    overlayStart.removeAttribute('hidden');
  });

  selN.addEventListener('change', ()=>{ init(); });

  // 첫 로드 시 오버레이 보이기 (게임 시작 전에는 보드 클릭 무시)
  overlayStart.removeAttribute('hidden');
})();
</script>
</body>
</html>
